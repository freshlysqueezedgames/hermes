"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var toString=Object.prototype.toString,Action=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Object.create(null),d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object.create(null),e=arguments[3];_classCallCheck(this,a);var f=this;if(!b||"string"!=typeof b)throw new Error("the first parameter must be a string identifier");f.name=b,c&&(f.payload=c),f.context=d}return _createClass(a,[{key:"Is",value:function(a){return a===this.name}}]),a}();Action.DEFAULT="action.default",exports.default=Action,"use strict",Object.defineProperty(exports,"__esModule",{value:!0}),exports.Reducer=void 0;var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_pathToRegexp=require("path-to-regexp"),_pathToRegexp2=_interopRequireDefault(_pathToRegexp),_emitter=require("@freshlysqueezedgames/emitter"),_emitter2=_interopRequireDefault(_emitter),_Action=require("./Action"),_Action2=_interopRequireDefault(_Action),_Reducer=require("./Reducer"),_Reducer2=_interopRequireDefault(_Reducer),_Route=require("./Route"),_Route2=_interopRequireDefault(_Route);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _Object$prototype=Object.prototype,toString=_Object$prototype.toString,hasOwnProperty=_Object$prototype.hasOwnProperty,instances={};function Hermes(a){function b(a){for(var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:k,c=this,d=-1,e=b.length,f=void 0,g=void 0,h=void 0;++d<e;){var l=b[d];if(l.position===a.length){for(var m,n=a.length;n--&&(m=a[n],l.position!==n+1||l.step===m||":"===l.step[0]);)l.position===n+1&&(l=l.parent);if(-1===n){for(l=b[d],h=l,g=[l.step];(l=l.parent)&&l.step;)g.unshift(l.step);f=a.slice(0,g.length);break}}}return{requestPath:f,result:h}}function c(a,c){var e=this;return e.verbose&&console.log("getting this path!",a),new Promise(function(f){var g=a.split("/"),h=b.call(e,g),i=h.requestPath,j=h.result,k=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Object.create(null);c.payload=a,d.call(e,g,c),p.Dispatch(),f&&f()};if(!i)return void k(c.payload);g.splice(i.length),e.verbose&&console.log("requesting this path!",i.join("/"));var l=new XMLHttpRequest;l.open("GET","./arc?query="+encodeURIComponent(j.config.query)),l.onload=function(){var a=JSON.parse(l.response);a.error&&console.log("there was an error associated with this request"),k(_extends({},c.payload,a.data))},l.send()})}function d(a,c){var d=this,h=f(g,a,function(e,f,g){var h=a.slice(0,g+1),i=b.call(d,h,j,!0),k=i.result,m=g===a.length-1?c.payload:void 0;return p.SetContext(h.join("/")),k&&k.reducer?k.reducer.Reduce(c,e,m):l.Reduce(c,e,m)});e(h,c.payload,function(e,f,g){var h=[].concat(_toConsumableArray(a),_toConsumableArray(g)),i=b.call(d,h,j,!0),k=i.result;return p.SetContext(h.join("/")),k&&k.reducer?k.reducer.Reduce(c,e,f):l.Reduce(c,e,f)},i)}function e(a,b,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:[];if("[object Array]"===toString.call(b)){for(var f=-1,g=void 0;g=b[++f];){var h=[].concat(_toConsumableArray(d),[f]),j=toString.call(g);a[f]=e(c(a[f]||("[object Array]"===j?Array(g.length):Object.create(null)),g,h),g,c,h)}return a}for(var k in b){var l=b[k],m=toString.call(l);if("[object Object]"===m||"[object Array]"===m){var n=[].concat(_toConsumableArray(d),[k]);a[k]=e(c(a[k]||("[object Array]"===m?Array(l.length):Object.create(null)),l,n),l,c,n)}}return a}function f(a,b,c){var d=!!(3<arguments.length&&arguments[3]!==void 0)&&arguments[3],e=-1,f=b.length;for(c=c||function(a){return a};++e<f;){var g=b[e];g&&(a[g]=c(a[g]||Object.create(null),g,e),d&&(a[g].parent=a),a=a[g])}return a}if(!a||!a.name)throw new Error("all Hermes instances must have a unique name ({name : [YOUR NAME]}) to be able to recover them globally");var g=Object.create(null),h=Object.create(null),k=[],i=Object.create(null),j=[],l=new _Reducer2.default,m=[],n=Object.create(null),o="",p=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"AddEvent",value:function(a,b){m.push({name:a,payload:b,context:o})}},{key:"SetContext",value:function(a){o=a}},{key:"Subscribe",value:function(a,b,c){var d=n[a]=n[a]||[];b.projection=c,d.push(b)}},{key:"Dispatch",value:function(){for(var a=-1,b=void 0;b=m[++a];)if(n[b.name])for(var c,d=n[b.name],e=-1,f=void 0;f=d[++e];){if(c=Object.create(null),f.projection)for(var g in f.projection){for(var h=f.projection[g],k=b.payload,o=0,p=h.length;(k=k[h[o++]])&&o<p;);c[g]=k}else c=b;f(c,b.context)&&d.splice(e--,1)}m=[]}}]),a}();l.Events=function(){return p};var q=function(){function a(b){if(_classCallCheck(this,a),b.paths)for(var c in b.paths=OrderByLongest(b.paths),b.paths){var d=new _Route2.default(c,b.paths[c]),e=f(h,c.split("/"),function(a,b,c){return a.step=b,a.position=c+1,a},!0);k.push(e),e.config=d}else b.verbose&&console.warn("No paths have been defined for the instance: ",b.name,"this means no data will be pulled from the server");if(b.reducers)for(var g in b.reducers=OrderByLongest(b.reducers),b.reducers){var l=b.reducers[g];if(!(l instanceof _Reducer2.default))throw new Error("Property at path: ",g," is not a Reducer instance!");l.Events=function(){return p};var m=f(i,g.split("/"),function(a,b,c){return a.step=b,a.position=c+1,a},!0);j.push(m),m.reducer=l,l.path=g}else b.verbose&&console.warn("No reducers have been defined for the instance, this means all data will be copied as submitted in action payloads: ",b.name);var n=this;n.verbose=b.verbose||!1,n.paths=b.paths||!1}return _createClass(a,[{key:"Subscribe",value:function(a,b,c){var d=this;if(!a||"string"!=typeof a||"[object Function]"!==toString.call(b))return console.warn("you must always call Subscribe with a string path and a callback function",a,b),d;for(var e in c)c[e]=c[e].split("/");return p.Subscribe(a,b,c),d}},{key:"Do",value:function(a){var b=this;if(!(a instanceof _Action2.default))throw new Error("Parameter 1 must be an Action instance",a);for(var d,e=j.length,f=void 0,g=a.Reducer();e--;)if(d=j[e].reducer,g===d){f=d.path,d.Submission(a);break}return c.call(b,_pathToRegexp2.default.compile(f)(a.context),a)}},{key:"Print",value:function(){console.log("this is the store",g)}}],[{key:"Instance",value:function(b){return new a(b)}}]),a}();return instances[a.name]||(instances[a.name]=new q(a))}function OrderByLongest(a){var b=Object.keys(a),c=Object.create(null);b.sort(function(c,a){return c.length>a.length?-1:a.length>c.length?1:0});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}Hermes.Instance=function(a,b){if(instances[a])return instances[a];if(!b)throw new Error("no instance exists under this name, you can create a new instance here but must provide properties as a second parameter");return b.name=a,new Hermes(b)},exports.Reducer=_Reducer2.default,exports.default=Hermes,"use strict","use strict",Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_Action2=require("./Action"),_Action3=_interopRequireDefault(_Action2);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var toString=Object.prototype.toString,id=0,Reducer=function(){function a(b){_classCallCheck(this,a);var c=this;c.actions=b||{},c.path="",c.Events=null,c.id=id++}return _createClass(a,[{key:"Submission",value:function(){return this}},{key:"Reduce",value:function(){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Object.create(null),b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Object.create(null),c=this;return"[object Array]"===toString.call(a)?(a.length===b.length&&[].concat(_toConsumableArray(a)),[].concat(_toConsumableArray(b))):_extends({},a,b)}},{key:"Action",value:function(a,b,c){var d=this,e=new _Action3.default(a,b,c);return e.Reducer=function(){return d},e}},{key:"Dispatch",value:function(a,b){this.Events().AddEvent(a,b)}}]),a}();Reducer.EVENTS={CHANGE:"reducer.change"},exports.default=Reducer,"use strict",Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_pathToRegexp=require("path-to-regexp"),_pathToRegexp2=_interopRequireDefault(_pathToRegexp);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var Route=function a(b,c){_classCallCheck(this,a);var d=this;"object"!==("undefined"==typeof c?"undefined":_typeof(c))&&(c=Object.create(null)),d.ToPath=_pathToRegexp2.default.compile(b),d.re=(0,_pathToRegexp2.default)(b);!0===c||(d.query=c.query,c.literalPath&&(d.literalPath=c.literalPath))};exports.default=Route;